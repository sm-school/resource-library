const concat = require('concat-stream');
const fs = require('fs');

import { dataUrl, getThumbnailFromApi } from '../src/services/thumbnail';
// import { getThumbnail, saveThumbnail } from '../src/services/db';

describe('thumbnails', () => {
	it('should produce a data: URL for the contents of an image file', () => {
		function loadedImage(imageBuffer) {
			let dataUrlResult = dataUrl(imageBuffer);
			expect(dataUrlResult).toEqual(testImageDataUrl);
		}

		const readStream = fs.createReadStream('tests/test.jpg');
		readStream.pipe(concat(loadedImage));
	});
});

const testImageDataUrl = 'data:image/jpeg;base64,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';